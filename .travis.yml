language: minimal

os:
  - linux

services:
  - docker

addons:
  apt:
    update: true
  homebrew:
    update: true
    brewfile: true

jobs:
  include:
    - { if: branch = master, os: linux, dist: bionic }
    - { if: branch = master, os: linux, dist: xenial }

    - os: linux
      services: docker
      install:
        - docker build --tag azlint:dev .
      script:
        - docker run --interactive --tty --rm --volume "${PWD}:/project" --volume "/var/run/docker.sock:/var/run/docker.sock" azlint:dev

install:
  - make bootstrap build

script:
  - make run
